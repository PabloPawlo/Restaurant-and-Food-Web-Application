<!DOCTYPE html>
<html>

<head>
   <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
   <link rel="icon" type="image/png" href="ico.png">
   <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/style.css') }}">
   <title>Strefa klienta - zamów</title>
   <meta http-equiv="content-type" content="text/html; charset=utf-8">
   <meta name="author" content="Paweł Pawlica">
   <meta name="description" content="treść">
   <meta name="keywords" content="słowa kluczowe">
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />

   <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
   <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
</head>

<body>
   <h3>Foods - Flask SQLAlchemy example</h3>
   <hr />

   {%- for category, message in get_flashed_messages(with_categories = true) %}
   <div class="alert alert-danger">
      {{ message }}
   </div>
   {%- endfor %}


   <ul>
      {% for food in foods %}
      <li class="foodz">
         <span>{{ food.name }}</span>

         <span>{{ food.time }}</span>

         <input type="hidden" value={{food.id}}>

         <input type="checkbox">
      </li>
      {%- endfor %}
   </ul>

   <form method="post" id="eisenshreschen">
      <input type="text" name="uname" placeholder="Uname" id="name"/><br>
      <input type="submit" value="Submit" />
   </form>
   
   <script>
      document.querySelector('form#eisenshreschen').onsubmit = function (e) {
         e.preventDefault();

         const listElements = document.querySelectorAll('li.foodz');
         const ids = [];
         for (const listElement of listElements) {
            if (listElement.querySelector('input[type=checkbox]').checked) {
               ids.push(listElement.querySelector('input[type=hidden]').value);
            }
         }
         console.log(ids);
         console.log(document.querySelector('#name'));
         const name = document.querySelector('#name').value;
         fetch('http://localhost:5000/tak', {
            headers: {
               'Accept': 'application/json',
               'Content-Type': 'application/json'
            },
            method: 'POST',
            body: JSON.stringify({
               tab: ids,
               name: name
            })
         }).then(res => document.location = res.url).catch(err => console.warn(err));
      }
   </script>
</body>

</html>